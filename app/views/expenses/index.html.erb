<%= link_to "Add Expense information", new_expense_path, class: "btn btn-primary" %>
<br><br>

<%= form_tag(expenses_path, :method => "get", class: "form-inline") do %>
    <%= text_field_tag :search, params[:search], placeholder: "Search by Product or Name", class: "form-control" %>
    <%= submit_tag "Search", class: "btn btn-primary" %>
<% end %>
<br>

<% @number=@expenses.offset + 1 %>
<h1>Expense List</h1>
<table class="table table-bordered">
  <thead>
  <tr>
    <th>Sl</th>
    <th>Name</th>
    <th>Employee</th>
    <th>Cost</th>
    <th>Status</th>
    <th>Action</th>
  </tr>
  </thead>

  <% @expenses.each do |expense| %>
      <tr>
        <td><%= @number %> </td>
        <% @number+=1 %>
        <td><%= expense.product_name %></td>
        <td><%= expense.user.name %></td>
        <td><%= expense.cost %></td>
        <td><%= expense.status %></td>
        <td>
          <% if current_user.role==User::ADMIN %>
              <% if expense.status==Expense::APPROVED %>
                  <%= link_to "Undo", approve_expense_path(expense), method: :put, data: {confirm: 'Are you sure to approve?'} %>
                  /
                  <%= link_to "Show", expense_path(expense) %>
              <% else %>
                  <%= link_to "Approve", approve_expense_path(expense), method: :put, data: {confirm: 'Are you sure to approve?'} %>
                  /
                  <%= link_to "Show", expense_path(expense) %>
                  <% if expense.user_id==current_user.id %>
                      / <%= link_to "Edit", edit_expense_path(expense) %> /
                      <%= link_to "Delete", expense_path(expense), method: :delete, data: {confirm: "Are you sure?"} %>
                  <% end %>
              <% end %>
          <% else %>
              <%= link_to "Show", expense_path(expense) %>
              <% if expense.status!=Expense::APPROVED and current_user.id==expense.user.id %>
                  / <%= link_to "Edit", edit_expense_path(expense) %> /
                  <%= link_to "Delete", expense_path(expense), method: :delete, data: {confirm: "Are you sure?"} %>
              <% end %>
          <% end %>


        </td>
      </tr>
  <% end %>
</table>

<%= will_paginate @expenses, renderer: WillPaginate::ActionView::BootstrapLinkRenderer %>


<div class="form-group">
  <%= link_to "Back", root_path, class: "btn btn-primary" %>
</div>
